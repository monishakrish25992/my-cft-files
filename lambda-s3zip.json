{
   "AWSTemplateFormatVersion":"2010-09-09",
   "Description":"Lambda function to an S3 bucket using cloudformationt",
   "Parameters":{
      "BucketName":{
         "Description":"S3 bucket name for aws",
         "Type":"String",
         "Default":"lambda-s3zipfile-access"
      },
      "S3Key":{
         "Description":"S3 Object key",
         "Type":"String",
         "Default":"test"
      },
      "Mylambda":{
         "Description":"lambda name for aws",
         "Type":"String",
         "Default":"lambda-s3access"
      }
   },
   "Resources":{
      "LambdaRole":{
         "Type":"AWS::IAM::Role",
         "Properties":{
            "AssumeRolePolicyDocument":{
               "Version":"2012-10-17",
               "Statement":[
                  {
                     "Effect":"Allow",
                     "Principal":{
                        "Service":[
                           "lambda.amazonaws.com"
                        ]
                     },
                     "Action":[
                        "sts:AssumeRole"
                     ]
                  }
               ]
            },
            "Policies":[
               {
                  "PolicyName":"LambdaPolicy",
                  "PolicyDocument":{
                     "Version":"2012-10-17",
                     "Statement":[
                        {
                           "Effect":"Allow",
                           "Action":[
                              "logs:CreateLogGroup",
                              "logs:CreateLogStream",
                              "logs:PutLogEvents"
                           ],
                           "Resource":"*"
                        }
                     ]
                  }
               }
            ]
         }
      },
      "LambdaFunction":{
         "Type":"AWS::Lambda::Function",
         "Properties":{
            "Handler":"main.main",
            "Role":{
               "Fn::GetAtt":[
                  "LambdaRole",
                  "Arn"
               ]
            },
            "Code":{
               "S3Bucket":{
                  "Ref":"BucketName"
               },
               "S3Key":{
                  "Ref":"S3Key"
               }
            },
            "Runtime":"python3.6",
            "Timeout":"30"
         }
      }
   }
}